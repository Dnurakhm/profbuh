# Исправление ошибки 403 Forbidden при отправке сообщений

## Проблема
При попытке отправить сообщение в чате возникает ошибка:
```
POST https://...supabase.co/rest/v1/messages 403 (Forbidden)
```

## Причина
В Supabase включен RLS (Row Level Security) на таблице `messages`, но нет политик, разрешающих вставку сообщений.

## Решение

### Шаг 1: Выполните SQL в Supabase

1. Откройте [Supabase Dashboard](https://supabase.com/dashboard)
2. Выберите ваш проект
3. Перейдите в **SQL Editor**
4. Откройте файл `supabase_messages_rls.sql` из корня проекта
5. Скопируйте весь SQL код и выполните его
6. Убедитесь, что выполнение прошло успешно

### Шаг 2: Проверьте работу

1. Перезагрузите страницу с чатом
2. Попробуйте отправить сообщение
3. Ошибка 403 должна исчезнуть

## Что делает SQL

Создает политики RLS для таблицы `messages`:

1. **SELECT** - пользователи могут читать сообщения в проектах, где они участники
2. **INSERT** - пользователи могут отправлять сообщения в проектах, где они участники
3. **UPDATE** - пользователи могут обновлять только свои сообщения
4. **DELETE** - пользователи могут удалять только свои сообщения

## Дополнительно

Также добавлена обработка ошибок в компоненте чата (`src/components/chat.tsx`):
- Теперь при ошибке отправки показывается alert с описанием проблемы
- Ошибки логируются в консоль для отладки

## Если проблема осталась

1. Проверьте, что пользователь авторизован (`auth.uid()` не NULL)
2. Проверьте, что пользователь является участником проекта (client_id или accountant_id)
3. Проверьте консоль браузера на другие ошибки
4. Убедитесь, что RLS включен на таблице `messages` в Supabase Dashboard
